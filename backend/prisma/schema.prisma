generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DATABASE_URL_UNPOOLED")
}

enum UserType { 
  ADMIN

  UG_STUDENT
  PG_STUDENT

  ASSISTANT_PROFS
  ASSOCIATE_PROFS
  PROFS

  HOD
  REGISTRAR
  CLERKS

  PRINCIPAL
  DEAN
  DIRECTOR
  LIBRARIAN
  LAB_ASSISTANT
  SECURITY_STAFF
  JANITORIAL_STAFF
  TRANSPORT_STAFF
  CAFETERIA_STAFF
  LAB_TECHNICIANS
  IT_STAFF

  GUEST
  ALUMINI
}

enum DptType { 
  AE              //Aerospace Engineering
  AIDS            //Artificial Intelligence and Data Science
  AIML            //Artificial Intelligence and Machine Learning
  BT              //Biotechnology
  CH              //Chemical Engineering
  CV              //Civil Engineering
  CSE             //Computer Science and Engineering
  CSE_AIML        //Computer Science and Engineering (AI-ML)
  CSE_CS          //Computer Science and Engineering (Cyber Security)
  EEE             //Electrical and Electronics Engineering
  ECE             //Electronics & Communication Engineering
  EIE             //Electronics & Instrumentation Engineering
  ETC             //Electronics & Telecommunication Engineering
  IEM             //Industrial Engineering & Management
  ISE             //Information Science & Engineering	
  ME              //Mechanical Engineering	
  MEE             //Medical Electronics Engineering	
}

enum SectionType { 
  A 
  B 
  C 
  D
}

enum ServerType {
  SEMINAR
  EVENT
}

model User {
  id              Int           @id @default(autoincrement())
  type            UserType
  usn             String        @unique
  name            String
  department      DptType?
  admissionYear   Int?
  year            Int?
  semester        Int?
  section         SectionType?
  createdAt       DateTime       @default(now())

  reportsFiled    Report[]      @relation("Reporter")
  reportsReceived Report[]      @relation("Reported")
}

model Server {
  id              Int           @id @default(autoincrement())
  name            String      
  type            ServerType  
  about           String
  createdAt       DateTime      @default(now())
  allowAnonymous  Boolean       @default(false)

  parent          Server?       @relation("ServerHierarchy", fields: [parentId], references: [id], onDelete: SetNull)
  parentId        Int?
  childServers    Server[]      @relation("ServerHierarchy")
  
  audience        Audience      @relation(fields: [audienceId], references: [id])
  audienceId      Int
}

model Audience {
  id              Int            @id @default(autoincrement())
  year            Int[]
  semester        Int[]
  department      DptType[]
  userTypes       UserType[]     @map("user")
  usn             String[]
  guest           String[]
  createdAt       DateTime       @default(now())

  servers         Server[]
}

model Report {
  id              Int           @id @default(autoincrement())
  reason          String
  severity        Int
  fine            Float         @default(0.0)
  createdAt       DateTime      @default(now())

  reporter        User          @relation("Reporter", fields: [reporterId], references: [id])
  reporterId      Int
  reported        User          @relation("Reported", fields: [reportedId], references: [id])
  reportedId      Int
}