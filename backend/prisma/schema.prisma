generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DATABASE_URL_UNPOOLED")
}

enum UserType { 
  UG_STUDENT                          //1MS-20-CS-001                //999 students per Semester
  PG_STUDENT                          //1MS-20-CS-001                //999 students per Semester

  ASSISTANT_PROFS                     //1MS-AS-CS-001                //999 per Department
  ASSOCIATE_PROFS                     //1MS-AP-ME-001                //999 per Department
  PROFS                               //1MS-PP-CE-001                //999 per Department

  HOD                                 //1MS-HD-CS-001                //999 per Department
  REGISTRAR                           //1MS-RR-CS-001                //999 per Department
  CLERKS                              //1MS-CK-ME-001                //999 per Department
  COORDINATOR                         //1MS-CR-CE-001                //999 per Department


  //roles which need no DEPARTMENT

  PRINCIPAL                           //1MS-PR-XX-001                //999 users
  DEAN                                //1MS-DE-XX-001                //999 users
  DIRECTOR                            //1MS-DR-XX-001                //999 users
  LIBRARIAN                           //1MS-LB-XX-001                //999 users
  LAB_ASSISTANT                       //1MS-LA-XX-001                //999 users
  SECURITY_STAFF                      //1MS-SC-XX-001                //999 users
  JANITORIAL_STAFF                    //1MS-JT-XX-001                //999 users
  TRANSPORT_STAFF                     //1MS-TS-XX-001                //999 users
  CAFETERIA_STAFF                     //1MS-CF-XX-001                //999 users
  LAB_TECHNICIANS                     //1MS-LT-XX-001                //999 users
  IT_STAFF                            //1MS-IT-XX-001                //999 users

  GUEST                               //1MS-X-G-00001                //10,48,575 guests
  ALUMINI                             //1MS-X-A-00001                //10,48,575 alumini
  ADMIN                               //1MS-X-X-00001                //10,48,575 admins
}

enum DptType { 
  AE              //Aerospace Engineering
  AIDS            //Artificial Intelligence and Data Science
  AIML            //Artificial Intelligence and Machine Learning
  BT              //Biotechnology
  CH              //Chemical Engineering
  CV              //Civil Engineering
  CSE             //Computer Science and Engineering
  CSE_AIML        //Computer Science and Engineering (AI-ML)
  CSE_CS          //Computer Science and Engineering (Cyber Security)
  EEE             //Electrical and Electronics Engineering
  ECE             //Electronics & Communication Engineering
  EIE             //Electronics & Instrumentation Engineering
  ETC             //Electronics & Telecommunication Engineering
  IEM             //Industrial Engineering & Management
  ISE             //Information Science & Engineering	
  ME              //Mechanical Engineering	
  MEE             //Medical Electronics Engineering	
}

enum SectionType { 
  A 
  B 
  C 
  D
}

enum ServerType {
  SEMINAR
  EVENT
}

enum StatusType {
  pending
  approved
  blocked
}

model User {
  id              Int           @id @default(autoincrement())
  type            UserType
  usn             String        @unique
  name            String
  department      DptType?
  admissionYear   Int?
  year            Int?
  semester        Int?
  section         SectionType?
  createdAt       DateTime       @default(now())

  status          StatusType     @default(pending)

  reportsFiled    Report[]      @relation("Reporter")
  reportsReceived Report[]      @relation("Reported")
}

model Server {
  id              Int           @id @default(autoincrement())
  name            String      
  type            ServerType  
  about           String
  createdAt       DateTime      @default(now())
  allowAnonymous  Boolean       @default(false)

  parent          Server?       @relation("ServerHierarchy", fields: [parentId], references: [id], onDelete: SetNull)
  parentId        Int?
  childServers    Server[]      @relation("ServerHierarchy")
  
  audience        Audience      @relation(fields: [audienceId], references: [id])
  audienceId      Int
}

model Audience {
  id              Int            @id @default(autoincrement())
  year            Int[]
  semester        Int[]
  department      DptType[]
  userTypes       UserType[]     @map("user")
  usn             String[]
  guest           String[]
  createdAt       DateTime       @default(now())

  servers         Server[]
}

model Report {
  id              Int           @id @default(autoincrement())
  reason          String
  severity        Int
  fine            Float         @default(0.0)
  createdAt       DateTime      @default(now())

  reporter        User          @relation("Reporter", fields: [reporterId], references: [id])
  reporterId      Int
  reported        User          @relation("Reported", fields: [reportedId], references: [id])
  reportedId      Int
}